<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
      th:replace="~{admin/layout :: layout(~{::title}, ~{::content}, ~{}, ~{})}">
<head>
    <title>Chi tiết đăng ký</title>
</head>
<body>
    <div th:fragment="content">
        <div class="row">
            <div class="col-12 col-lg-4 mb-4">
                <div class="card shadow-sm">
                    <div class="card-body text-center p-4">
                        <div class="mb-3">
                            <span class="badge rounded-pill px-3 py-2"
                                  th:classappend="${enrollment.status.name() == 'APPROVED' ? 'bg-success' : (enrollment.status.name() == 'PENDING' ? 'bg-warning text-dark' : 'bg-danger')}"
                                  th:text="${enrollment.status}">STATUS</span>
                        </div>
                        <h5 class="fw-bold mb-1">Mã ĐK: <span th:text="'#' + ${enrollment.id}">#1</span></h5>
                        <p class="text-muted small" th:text="${#temporals.format(enrollment.enrollmentDate, 'dd/MM/yyyy HH:mm')}">Date</p>
                        
                        <hr>
                        
                        <div class="d-flex justify-content-between mb-2">
                            <span class="text-muted">Học phí</span>
                            <span class="fw-bold" th:text="${#numbers.formatDecimal(enrollment.classEntity.course.tuitionFee, 0, 'COMMA', 0, 'POINT') + ' VNĐ'}">0 VNĐ</span>
                        </div>
                         <div class="d-flex justify-content-between mb-2">
                            <span class="text-muted">Đã đóng</span>
                            <span class="fw-bold text-success" th:text="${#numbers.formatDecimal(enrollment.paidAmount != null ? enrollment.paidAmount : 0, 0, 'COMMA', 0, 'POINT') + ' VNĐ'}">0 VNĐ</span>
                        </div>
                    </div>
                    
                    <!-- Action Buttons based on status -->
                    <div class="card-footer bg-white p-3" th:if="${enrollment.status.name() == 'PENDING'}">
                        <div class="d-grid gap-2">
                             <form th:action="@{/admin/enrollments/{id}/approve(id=${enrollment.id})}" method="post">
                                <button type="submit" class="btn btn-success w-100 mb-2">Duyệt đăng ký</button>
                            </form>
                            <button type="button" class="btn btn-outline-danger" data-bs-toggle="modal" data-bs-target="#rejectModal">
                                Từ chối
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-12 col-lg-8">
                <div class="card shadow-sm mb-4">
                    <div class="card-header bg-white py-3">
                        <h5 class="mb-0 fw-bold">Thông tin chi tiết</h5>
                    </div>
                    <div class="card-body">
                        <h6 class="fw-bold text-primary mb-3"><i class="fas fa-user me-2"></i>Thông tin học viên</h6>
                        <div class="row mb-3">
                            <div class="col-sm-4 text-muted">Họ và tên</div>
                            <div class="col-sm-8 fw-medium" th:text="${enrollment.student.fullName}">Name</div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-sm-4 text-muted">Email</div>
                            <div class="col-sm-8" th:text="${enrollment.student.email}">Email</div>
                        </div>
                         <div class="row mb-4">
                            <div class="col-sm-4 text-muted">Số điện thoại</div>
                            <div class="col-sm-8" th:text="${enrollment.student.phone}">Phone</div>
                        </div>

                        <h6 class="fw-bold text-primary mb-3"><i class="fas fa-book me-2"></i>Thông tin khóa học</h6>
                        <div class="row mb-3">
                            <div class="col-sm-4 text-muted">Khóa học</div>
                            <div class="col-sm-8 fw-medium" th:text="${enrollment.classEntity.course.name}">Course</div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-sm-4 text-muted">Lớp học</div>
                            <div class="col-sm-8">
                                <a th:if="${enrollment.classEntity}" 
                                   th:href="@{/admin/classes/{id}(id=${enrollment.classEntity.id})}"
                                   th:text="${enrollment.classEntity.className}" class="text-decoration-none">Class</a>
                                <span th:unless="${enrollment.classEntity}" class="text-muted fst-italic">Chưa xếp lớp</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Payment Update -->
                <div class="card shadow-sm">
                    <div class="card-header bg-white py-3">
                        <h5 class="mb-0 fw-bold">Cập nhật thanh toán</h5>
                    </div>
                    <div class="card-body">
                        <form th:action="@{/admin/enrollments/{id}/update-payment(id=${enrollment.id})}" method="post" class="row g-3 align-items-end">
                            <div class="col-md-8">
                                <label class="form-label">Số tiền đã đóng</label>
                                <input type="number" name="amount" class="form-control" 
                                       th:value="${enrollment.paidAmount}" min="0" required>
                            </div>
                            <div class="col-md-4">
                                <button type="submit" class="btn btn-primary w-100">
                                    <i class="fas fa-save me-2"></i>Cập nhật
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Reuse Reject Modal if needed, similar to pending page -->
         <div class="modal fade" id="rejectModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <form th:action="@{/admin/enrollments/{id}/reject(id=${enrollment.id})}" method="post">
                        <div class="modal-header">
                            <h5 class="modal-title">Từ chối đăng ký</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body text-start">
                            <div class="mb-3">
                                <label class="form-label">Lý do từ chối</label>
                                <textarea name="reason" class="form-control" rows="3" required placeholder="Nhập lý do..."></textarea>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                            <button type="submit" class="btn btn-danger">Xác nhận từ chối</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
