<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
      th:replace="~{admin/layout :: layout(~{::title}, ~{::content}, ~{}, ~{})}">
<head>
    <title>Chi tiết chứng chỉ</title>
</head>
<body>
    <div th:fragment="content">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-8">
                <!-- Certificate Card -->
                <div class="card shadow-sm border-0 mb-4">
                    <div class="card-body p-5 text-center position-relative overflow-hidden">
                        <!-- Background Pattern (CSS only for simplicity) -->
                        <div style="position: absolute; top: 0; left: 0; width: 100%; height: 10px; background: linear-gradient(to right, #4F46E5, #7C3AED);"></div>
                        
                        <div class="mb-4">
                            <i class="fas fa-graduation-cap fa-4x text-primary mb-3"></i>
                            <h2 class="fw-bold text-uppercase ls-2">Chứng chỉ hoàn thành</h2>
                            <p class="text-muted text-uppercase letter-spacing-2">Certificate of Completion</p>
                        </div>

                        <div class="py-4">
                            <p class="lead mb-2">Chứng nhận học viên</p>
                            <h3 class="fw-bold text-dark mb-4" th:text="${certificate.enrollment.student.fullName}">STUDENT NAME</h3>
                            
                            <p class="mb-2">Đã hoàn thành xuất sắc khóa học</p>
                            <h4 class="text-primary fw-bold mb-4" th:text="${certificate.enrollment.classEntity.course.name}">COURSE NAME</h4>
                            
                            <div class="row justify-content-center mb-4">
                                <div class="col-auto text-start">
                                    <div class="small text-muted text-uppercase">Mã số</div>
                                    <div class="fw-bold font-monospace" th:text="${certificate.certificateCode}">CODE</div>
                                </div>
                                <div class="col-auto text-start ps-4 border-start">
                                    <div class="small text-muted text-uppercase">Ngày cấp</div>
                                    <div class="fw-bold" th:text="${#temporals.format(certificate.issueDate, 'dd/MM/yyyy')}">DATE</div>
                                </div>
                            </div>
                        </div>

                        <div class="mt-4 pt-4 border-top">
                            <div class="row align-items-center">
                                <div class="col-6 text-start">
                                    <small class="text-muted">Xác nhận bởi</small><br>
                                    <strong>NUTE Training System</strong>
                                </div>
                                <div class="col-6 text-end">
                                    <!-- Signature Placeholder -->
                                    <div style="font-family: 'Cursive', serif; font-size: 1.5rem; color: #4F46E5;">Director</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Stamp -->
                        <div style="position: absolute; bottom: 20px; right: 20px; width: 100px; height: 100px; border: 3px double #EF4444; border-radius: 50%; display: flex; align-items: center; justify-content: center; transform: rotate(-15deg); opacity: 0.2;">
                            <span class="text-danger fw-bold text-uppercase" style="font-size: 0.8rem;">Official</span>
                        </div>
                    </div>
                </div>

                <!-- Actions -->
                <div class="card shadow-sm">
                    <div class="card-body d-flex justify-content-between align-items-center">
                        <div>
                            <span class="badge me-2"
                                  th:classappend="${certificate.status.name() == 'ISSUED' ? 'bg-success' : 'bg-danger'}"
                                  th:text="${certificate.status.name() == 'ISSUED' ? 'Đang có hiệu lực' : 'Đã bị thu hồi'}">VALID</span>
                            <span th:if="${certificate.status.name() != 'ISSUED'}" class="text-danger small" 
                                  th:text="'Lý do: ' + ${certificate.notes}">Reason</span>
                        </div>
                        
                        <div th:if="${certificate.status.name() == 'ISSUED'}">
                            <button type="button" class="btn btn-outline-danger" data-bs-toggle="modal" data-bs-target="#revokeModal">
                                <i class="fas fa-ban me-2"></i>Thu hồi chứng chỉ
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Revoke Modal -->
        <div class="modal fade" id="revokeModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <form th:action="@{/admin/certificates/{id}/revoke(id=${certificate.id})}" method="post">
                        <div class="modal-header">
                            <h5 class="modal-title">Thu hồi chứng chỉ</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="alert alert-warning">
                                <i class="fas fa-exclamation-triangle me-2"></i>
                                Hành động này sẽ làm mất hiệu lực của chứng chỉ vĩnh viễn.
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Lý do thu hồi <span class="text-danger">*</span></label>
                                <textarea name="reason" class="form-control" rows="3" required></textarea>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                            <button type="submit" class="btn btn-danger">Xác nhận thu hồi</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
